<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>JLU Dashboard Debug</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script>
        window.addEventListener('load', function() {
            const { useState, useEffect } = React;
            
            const Dashboard = () => {
                const [debugInfo, setDebugInfo] = useState('Starting...');
                const [fileList, setFileList] = useState([]);
                const [employees, setEmployees] = useState([]);
                const [loading, setLoading] = useState(true);
                
                const urlParams = new URLSearchParams(window.location.search);
                const currentStore = urlParams.get('store') || '609';
                
                useEffect(() => {
                    debugFileAccess(currentStore);
                }, [currentStore]);
                
                const debugFileAccess = async (storeNumber) => {
                    let debugLog = `Debugging Store ${storeNumber}:\n`;
                    
                    try {
                        // First, let's see what files are available
                        debugLog += 'Checking available data files...\n';
                        
                        // Try to list files in data directory (this might not work due to CORS)
                        try {
                            const response = await fetch('/data/');
                            debugLog += `Data directory response: ${response.status}\n`;
                        } catch (e) {
                            debugLog += `Can't list data directory: ${e.message}\n`;
                        }
                        
                        // Try different possible filenames
                        const today = new Date().toISOString().split('T')[0];
                        const possibleFilenames = [
                            `MDCReport_Store${storeNumber}_${today}.xlsx`,
                            `MDCReport-${storeNumber}-${today.replace(/-/g, '-')}.xlsx`,
                            `MDCReport-${storeNumber}-2025-08-28_02-49-27_20250828_145308.xlsx`,
                            `MDCReport-${storeNumber}-2025-08-28_02-50-20_20250828_145309.xlsx`
                        ];
                        
                        debugLog += `Trying filenames for store ${storeNumber}:\n`;
                        let foundFile = null;
                        
                        for (const filename of possibleFilenames) {
                            debugLog += `Trying: /data/${filename}\n`;
                            
                            try {
                                const response = await fetch(`/data/${filename}`);
                                debugLog += `  Response: ${response.status} ${response.statusText}\n`;
                                
                                if (response.ok) {
                                    debugLog += `  ✓ Found file: ${filename}\n`;
                                    foundFile = filename;
                                    
                                    // Try to read the Excel file
                                    const arrayBuffer = await response.arrayBuffer();
                                    debugLog += `  File size: ${arrayBuffer.byteLength} bytes\n`;
                                    
                                    const workbook = XLSX.read(arrayBuffer);
                                    debugLog += `  Worksheets: ${workbook.SheetNames.join(', ')}\n`;
                                    
                                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });
                                    debugLog += `  Data rows: ${jsonData.length}\n`;
                                    debugLog += `  First row keys: ${Object.keys(jsonData[0] || {}).slice(0, 5).join(', ')}\n`;
                                    
                                    // Show first few rows of data
                                    if (jsonData.length > 0) {
                                        debugLog += `  Sample data:\n`;
                                        jsonData.slice(0, 3).forEach((row, i) => {
                                            debugLog += `    Row ${i}: ${JSON.stringify(row).substring(0, 100)}...\n`;
                                        });
                                    }
                                    
                                    break;
                                } else {
                                    debugLog += `  ✗ Not found\n`;
                                }
                            } catch (e) {
                                debugLog += `  ✗ Error: ${e.message}\n`;
                            }
                        }
                        
                        if (!foundFile) {
                            debugLog += `No files found for store ${storeNumber}\n`;
                            debugLog += `Current date used: ${today}\n`;
                            debugLog += `Check that files exist in /data/ folder\n`;
                        }
                        
                    } catch (error) {
                        debugLog += `Overall error: ${error.message}\n`;
                    }
                    
                    setDebugInfo(debugLog);
                    setLoading(false);
                };
                
                if (loading) {
                    return React.createElement('div', {
                        className: 'min-h-screen bg-red-900 text-white p-4'
                    },
                        React.createElement('div', { className: 'max-w-4xl mx-auto' },
                            React.createElement('h1', { className: 'text-2xl font-bold mb-4' }, `Debug Mode - Store ${currentStore}`),
                            React.createElement('div', { className: 'text-sm' }, 'Loading and checking files...')
                        )
                    );
                }
                
                return React.createElement('div', {
                    className: 'min-h-screen bg-red-900 text-white p-4'
                },
                    React.createElement('div', { className: 'max-w-4xl mx-auto' },
                        React.createElement('h1', { className: 'text-2xl font-bold mb-4' }, `Debug Information - Store ${currentStore}`),
                        React.createElement('div', { className: 'mb-4' },
                            ['609', '1002', '1257', '1270'].map(store =>
                                React.createElement('a', {
                                    key: store,
                                    href: `?store=${store}`,
                                    className: `mr-2 px-3 py-1 rounded ${store === currentStore ? 'bg-white text-red-800' : 'bg-red-700'}`
                                }, `Store ${store}`)
                            )
                        ),
                        React.createElement('pre', { 
                            className: 'bg-black p-4 rounded text-sm text-green-400 overflow-auto max-h-96',
                            style: { fontFamily: 'monospace' }
                        }, debugInfo)
                    )
                );
            };
            
            ReactDOM.render(React.createElement(Dashboard), document.getElementById('root'));
        });
    </script>
</body>
</html>
